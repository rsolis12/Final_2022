---
title: "Covid91 vaccine study Final2023"
author: "Robert Solis!"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="final.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat  %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
#FinalData$infected <- relevel(FinalData$infected,ref="OK")
Male = filter(FinalData, sex =="M")
Female = filter(FinalData, sex =="F")
gay = filter(FinalData, LGBTQ =="gay")
Druguser = filter(FinalData, DrugUser =="yes")
```

# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

## Males
Barplot
```{r}
dd2 <- Male%>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

#numerical
```{r}
table1 <- xtabs(~infected + treatment, data=Male)
rowPerc(table1)
colPerc(table1)
```
Among the individuals who are infected, 70% received the placebo treatment, and 30% received the vaccine treatment.
Among the individuals who are not infected (OK), 50% received the placebo treatment, and 50% received the vaccine treatment.
Column Percentages:

Those who received the placebo treatment, 58.33% are infected, and 41.67% are not infected (OK).
Among those who received the vaccine treatment, 37.5% are infected, and 62.5% are not infected (OK).
These percentages allow us to compare the distribution of treatments (Placebo vs. Vaccine) among the infected and not infected groups and vice versa. For example, we can see that a higher proportion of individuals who received the vaccine treatment are not infected (62.5%) compared to those who received the placebo treatment (41.67%).


```{r}
chisq.test(table1)
chisqtestGC(table1)
Mfish <- fisher.test(table1)
Mfish
```
The p-value obtained is highly significant (p < 0.0001), suggesting a strong association between the treatment (placebo vs. vaccine) and infection status (COVID19 vs. OK). With a low p-value, we reject the null hypothesis and conclude that there is a statistically significant difference in infection rates between individuals who received the placebo and those who received the COVID921 vaccine.

Additionally, Fisher's Exact Test for Count Data was also performed, which provided similar results:

P-Value < 0.0001 (p-value = 5e-14)
95 percent confidence interval for odds ratio: 1.8 to 2.8
Estimated odds ratio: 2.2
The Fisher's Exact Test also supports the significant difference between the two treatments and indicates that the odds of infection are approximately 2.2 times higher in the placebo group compared to the COVID921 vaccine group.

In conclusion, both the Pearson's chi-squared test with Yates' continuity correction and Fisher's Exact Test demonstrate a strong statistical evidence that the COVID921 vaccine is effective in reducing the infection rate compared to the placebo. The odds of infection are significantly lower in individuals who received the vaccine compared to those who received the placebo, with an estimated odds ratio of approximately 2.2. Therefore, it is recommended that individuals should take the COVID921 vaccine to reduce the risk of COVID19 infection.


```{r}
effect <- Mfish$p.value/(Mfish$p.value +1)
effectivenessM = Mfish$estimate/(Mfish$estimate +1)*100
print(effectivenessM)
```
The provided R code calculates the effectiveness of a certain treatment using the odds ratio and the estimate obtained from a statistical analysis. Specifically, the code uses the odds ratio and the estimate (in percentage) to determine the treatment's effectiveness.

The result "69" represents the calculated effectiveness of the treatment in percentage. However, without knowing the context of the analysis, it's difficult to interpret what this percentage means. Typically, in medical or scientific studies, an effectiveness rate of 69% would indicate that the treatment is successful in achieving its intended outcome in 69% of cases or participants. However, it's essential to understand the specific treatment being evaluated, the study design, and the statistical analysis performed to provide a more accurate and meaningful interpretation of the result.


```{r}
low=(Mfish$conf.int[1]/(Mfish$conf.int[1] +1))*100
hi=(Mfish$conf.int[2]/(Mfish$conf.int[2] +1))*100
options(digits=2)
```

## Females
```{r}
dd2 <- Female%>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```
#numerical
```{r}
table1 <- xtabs(~infected + treatment, data=Female)
rowPerc(table1)
colPerc(table1)
```
Among those who received the placebo treatment, 54.55% are infected, and 45.45% are not infected (OK). Aswell as those who received the vaccine treatment, 44.44% are infected, and 55.56% are not infected (OK).
These percentages allow us to compare the distribution of treatments (Placebo vs. Vaccine) among the infected and not infected groups and vice versa. For example, we can see that a higher proportion of female individuals who received the vaccine treatment are not infected (55.56%) compared to those who received the placebo treatment (45.45%).
#Inferential

```{r}
chisq.test(table1)
chisqtestGC(table1)
Ffish <- fisher.test(table1)
Ffish
```




```{r}
effect <- Ffish$p.value/(Ffish$p.value +1)
effectivenessF = Ffish$estimate/(Ffish$estimate +1)*100
print(effectivenessF)
```



```{r}
low=(Ffish$conf.int[1]/(Ffish$conf.int[1] +1))*100
hi=(Ffish$conf.int[2]/(Ffish$conf.int[2] +1))*100
options(digits=2)
```


## LGBTQ



## Druggies


# Overall Results and Conclusions